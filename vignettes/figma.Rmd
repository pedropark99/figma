---
title: "Get your Figma file into R"
output: rmarkdown::html_vignette
author: "Pedro Duarte Faria"
vignette: >
  %\VignetteIndexEntry{Get your Figma file into R}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```


## Introduction

You might have some Figma files that you want to bring into R, to analyse, or, use the visual attributes
of the objects from this file to compose a layout that you want to use in a RMarkdown/Quarto file.

The `figma` package allows you to that. It uses the Figma API to bring all of the data from your Figma file into R.
It does this, by sending a HTTP request to the Figma API to collect all of the data of your Figma file, and them,
it parses this data into a R native object, so you can easily use it in your R process.

```{r setup, eval = FALSE}
library(figma)
```

But in order to use the Figma API, you need to collect two key informations about your file and your credentials. 
They are:

- `file_key`: The ID (or the "key") that identifies your Figma file;
- `token`: Your personal access token from the Figma platform;

Lets talk about these informations;

## Is always nice to read the official Figma API documentation

Much of the information described in this vignette comes from the official Figma API documentation, and
is always interesting to read from the source to learn more about a specific subject. I will give you
direct links to specific parts of the documentation throughout this vignette, but if you want to read
the complete documentation, you can access [this link](https://www.figma.com/developers/api).

## Findind the key (or ID) of your Figma file

The file key (or the file key), is a random text that identifies your Figma
file. The Figma API uses this key to identify which specific Figma file you
are requesting for.

You can find the key (or ID) of your Figma file by looking at the URL in your web browser, when you access your Figma file
at the Figma platform. As an example, lets use this Figma file entitled `Untitled` (I will not make a joke on that 
`r emoji::emoji("sweat_smile")`):

```{r file_example, echo = FALSE, fig.cap = "An example of Figma file"}
knitr::include_graphics("example-figma-file.png")
```

If we look at the top of my web browser, we have the following URL:

`https://www.figma.com/file/hch8YlkIrYbU3raDzjPvCz/Untitled?node-id=0%3A1`

The key (or the ID) of this file is `"hch8YlkIrYbU3raDzjPvCz"`. This means
that the URL of every Figma file is composed of this sctructure. So in
order to use the functions from the `figma` package, you should always
collect this `:file_key` portion of the URL, to get the key to your
file.

`https://www.figma.com/file/:file_key/:file_title?:node_id`


## Get your personal access token

If you do not have a personal access token, you can create one in the Figma
platform. Just log in the platform, and click on the `Settings` section, like
in the image below:

```{r, echo = FALSE, fig.cap = "Settings of Figma platform"}
knitr::include_graphics("figma-settings.png")
```

After that, look for the `Personal access token` section of the settings, like in
the image below. This is where you can create all of your personal access tokens. Just
add a description (or a "alias") to your token, and press Enter. A pop-up should appear
in your screen with your new token.

```{r, echo = FALSE, fig.cap = "Personal access token section in settings"}
knitr::include_graphics("create-token.png")
```

The Figma API uses this secret token to identify you, to know that is you that is requesting
for a file, and not someone else. Because of this, is important to keep this token a secret,
because if someone have it, they can access your Figma files through the API.

A standard way to store these passwords, is to store them in the `.Rprofile` file, but there are
many other methods that are good alternatives too. A good place to start is the 
[vignette from Hadley Wickham](https://cran.r-project.org/web/packages/httr/vignettes/secrets.html).


## Use `get_figma_file()` to get your Figma file 
Now that you have the key (or ID) that identifies your Figma file, and your personal token that
identifies yourself, you can use `get_figma_file()` to get your Figma file:

```{r, eval = FALSE}
file_key <- "hch8YlkIrYbU3raDzjPvCz"
# Insert your personal token:
token <- "Your personal token ..."

result <- figma::get_figma_file(
  file_key, token
)
# A `response` object:
print(result)
```

```
Response [https://api.figma.com/v1/files/hch8YlkIrYbU3raDzjPvCz]
  Date: 2022-10-29 16:56
  Status: 200
  Content-Type: application/json; charset=utf-8
  Size: 4.58 kB
{"document":{"id":"0:0","name":"Document","type":"DOCUMENT","children":[{"id":"0:1","name":"Page 1","typ...
```


## Using the `response` object

The functions from `figma` package have the philosophy of giving (by default) the most raw and unprocessed
result as possible to the user. This is good for debugging situations, because it gives
all the available information to the user.

However, this unprocessed result is usually not strucutured in a very friendly and useful format,
which makes analysis and transformation pipelines harder and more complex. That is why 
`get_figma_file()` comes with more output formats available through the `.output_format` argument,
which we will describe later.

To give you an useful example, you can access the exact `response` object returned by the code example
shown in the last section. This `response` object is stored in a object called `untitled_file`,
that you can access with `figma::untitled_file`. This object `untitled_file` contains all
of the data from the Figma file shown in Section.

All the data of your Figma file is in the `content` element of the y default, the Figma API sends the data of your Figma file as raw bytes



# The structure of a Figma file

A Figma file is represented as a tree of nodes. is composed of a set of canvas (or pages), and 
each canvas contains a set of multiple objects. So, the canvas is the visual space where you draw, 
and, each object represents a layer, or, a visual element that you add to this space.

Each object that you add can be of a different type (like TEXT, RECTANGLE, ARROW, etc.). 
But each canvas is always.
